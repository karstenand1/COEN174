<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

  <title>Judge Evaluation Form</title>
  <meta name="description" content="Judge Eval Form page 2">
  <meta name="author" content="Group 1">

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>
    <h1>Senior Design Conference Judge Evaluation Form</h1>
    <hr/>
    <table>
      <tr>
        <td>Judge ID: </td>
        <td id= "jID"> </td>
      </tr>
      <tr>
        <td>Judge Name:</td>
        <td id="jName"></td>
      </tr>
      <tr>
        <td>Session:</td>
        <td id="session"></td>
      </tr>
      <tr>
        <td>Room:</td>
        <td id="room"></td>
      </tr>

    </table>

    <form action="form3.html">
      Project Title: <input list="projects" name="project"><br>
      <datalist id="projects">
<!--         <option value="val1">
        <option value="val2">
          <option value="val3"> -->
          </datalist>
          <input type="hidden" id= "jIDhidden" name="judgeId" >
          <input type="hidden" id="jNamehidden" name="judgeName" >
          <input type="hidden" id= "sessionhidden" name="session" >
          <input type="hidden" id="roomhidden" name="room" >
          <input type="submit" value="Submit">
        </form>
        <script src="geturl.js"></script>

        <script>

          var jID = getUrlVars()["judgeId"];
          var jName = getUrlVars()["judgeName"];


          document.getElementById('jID').innerHTML= jID;
          document.getElementById('jName').innerHTML= jName;

          document.getElementById('jIDhidden').value= jID;
          document.getElementById('jNamehidden').value= jName;


          var splitID= jID.split("-");
          var department= splitID[0];
          var session= splitID[1];
          var judge= splitID[2];

          var deplist=['COEN', 'MECH', 'CIVIL', 'BIO', 'ELEN', 'INTER', 'WEB'] ;    

          document.getElementById('session').innerHTML= deplist[department] + " " + session;

          $.ajax({
            type:'GET',
            url:'getPres.php',
            data:{department: deplist[department], session: session},
            dataType:'json',
            success: function(response){
              console.log(response)
              document.getElementById('room').innerHTML= response[0].roomNum;
              document.getElementById('projects').innerHTML=populateList(response);
              document.getElementById('sessionhidden').value= deplist[department] + "-" + session;
              document.getElementById('roomhidden').value= response[0].roomNum;
            }
          });

      // document.getElementById('projects').innerHTML=populateList(["hello","hello"]);

      function populateList(list){
        var option="";
        $.each(list, function(index, element) {
          var proj= element.pTitle +"-"+ element.PID;
          var line=["<option value=\"", proj, "\">"].join(" ");
          option=option.concat(line, "\n");
        })
        return option;
      }

    </script>
  </body>
  </html>