<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <title>Detailed Score Report</title>
  <meta name="description" content="Judge Eval Form page 1">
  <meta name="author" content="Group 1">

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
    <![endif]-->

<!--     <style type="text/css">
      table, td, th {
        border: 1px solid #ddd;
        text-align: left;
      }

      table {
        border-collapse: collapse;
        width: 100%;
      }
      th, td {
        padding: 15px;
        text-align: left;
      }
    </style> -->
    <link rel="stylesheet" type="text/css" href="formstyle.css">
    <link rel="stylesheet" type="text/css" href="appstyle.css">

  </head>

  <body>
    <h1>Senior Design Detailed Score Reports</h1>
    <hr/>
    <table id="info" class="nobordertable displaydata">
    </table>
    <div id="report">
    </div>

    <script src="geturl.js"></script>

    <script src="mappings.js"></script>

    <script>


     function getreport(pid){
      $.ajax({
        type:'GET',
        url:'getDetRepSco.php',
        data:{PID: pid},
        dataType:'json',
        success: function(response){
          console.log(response);
          document.getElementById('report').innerHTML=displayReport(response);
          document.getElementById('info').innerHTML=displayInfo(response[0]);
        }
      });
    }

    function displayReport(data){
      var html="";
      header="";
      header+="<table><tr><th><u>"+ data[0].pTitle +"</u></th>"
      $.each(data, function(index, element) {
        line=["<th>", noplus(element.judgeName) , "</th>"].join(" ");
        header=header.concat(line, "\n");
      })
      
      html= html+ header + "</tr>";
     // console.log(html);


     for (var key in formMap) {
       row="<tr>"
       if (formMap.hasOwnProperty(key)) {
         line=["<td>", formMap[key] , "</td>"].join(" ");
         row=row.concat(line, "\n");

         $.each(data, function(index, element) {
          line=["<td>", noplus(element[key]) , "</td>"].join(" ");
          row=row.concat(line, "\n");
        })
         html=html+row+"</tr>";
          // console.log(row);
        }
      }
      line="<tr><td>Comments</td>"
      $.each(data, function(index, element) {
        line+=["<td>", decodeURI(element["comment"]) , "</td>"].join(" ");
      })
      line=line+"</tr>"

      html=html+line+"</table>"
      return html;

    }

    function displayInfo(info){

     var labels={"Advisor":"advisor", "Department Session": "depSesh", "Room": "roomNum" }

     info["depSesh"]=info["dept"]+" "+ info["sessionNo"];

     var url = noplus(getUrlVars()["PID"]);
     split= url.split("-")
     console.log(split);
     pid=split[0];
     advisor=split[1];
     team=split[2].replace(("%2C"),", ");
     var html=  "<tr><td style=\"font-weight:bold;\" class=\"leftcol\"> Team Members: </td><td>" + team+ "</td>" ;
     count=1;
     var row="";
     for (var key in labels) {
       if (count%2==0){
        row="<tr>"
      }
      else{
        row="";
      }
      if (labels.hasOwnProperty(key)) {
       line=["<td style=\"font-weight:bold;\" class=\"leftcol \">", key, "</td><td>", info[labels[key]] , "</td>"].join(" ");
       // console.log(row, line);
       row=row.concat(line, "\n");
       html=html+row;
       if (count%2!=0){
        row="</tr>";
      };

      console.log(html);
    }
    count+=1;
  }
  return html;

}

var url = noplus(getUrlVars()["PID"]);
split= url.split("-")
console.log(split);
pid=split[0];

getreport(pid);




</script>

</body>
</html>
